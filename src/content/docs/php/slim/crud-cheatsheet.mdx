---
title: 'Quick Reference: CRUD Operations in Slim MVC'
description: Quick reference guide for CRUD operations in Slim Framework
sidebar:
  label: 'CRUD Cheatsheet'
  order: 10
  badge:
    text: Reference
    variant: tip
---

This cheatsheet provides a quick reference for implementing CRUD operations in your Slim MVC application.

## Checklist for Implementing CRUD Operations

When implementing CRUD operations, you should follow these steps **for each resource** (e.g., products, categories, orders, users, etc.) in the **following order**:

1. ✅ Create a Model class (extends `BaseModel`, inject `PDOService`)
2. ✅ Create a Controller class (extends `BaseController`, inject `Container` and `Model` (s))
3. ✅ Implement 7 standard controller methods (index, show, create, store, edit, update, delete)
4. ✅ Create 4 view files (index, show, create, edit) for the resource
5. ✅ Register 7 routes in `web-routes.php` for the resource
6. ✅ Use named routes for redirects
7. ✅ Follow RESTful URI patterns
8. ✅ Validate input data before passing to model methods
9. ✅ Use Post-Redirect-Get pattern (PRG) pattern after successful form submissions to prevent duplicate submissions
10. ✅ Test all routes in browser

---

## Extracting Input Data from the Client Request 

In your controller's **callback methods**, you can extract the request data (route parameters, POST form data, query string parameters) from the request object using the following methods:

### 1. Get route parameter (from `{id}` placeholder)
Inputs passed in the URI path are called **route parameters**.
You can access them using the `$args` array parameter in your controller's callback method.

```php title="app/Controllers/YourController.php"
$productId = (int) $args['id']; // E.g., /products/123 -> $args['id'] = '123'
```

### 2. Get POST form data

Inputs passed in the **POST** request body are called **form data**. You can access them using the `$request->getParsedBody()` method.

```php title="app/Controllers/YourController.php"
$formData = $request->getParsedBody();
$productName = $formData['name'] ?? '';
$productPrice = $formData['price'] ?? 0;
```

### 3. Get query string parameters
Inputs passed in the **GET** request query string are called **query string parameters**. You can access them using the `$request->getQueryParams()` method.

```php title="app/Controllers/YourController.php"
$queryParams = $request->getQueryParams();
$search = $queryParams['search'] ?? '';
$sort = $queryParams['sort'] ?? 'name';
```

---


## Controller Class Structure

Create a controller class by extending `BaseController`. The constructor should call the parent constructor with the `Container` instance and inject model instance(s) into the controller's constructor.

### Standard Signatures of the Controller Callback Methods

```php title="app/Controllers/YourController.php"
<?php 
use Psr\Http\Message\ResponseInterface as Response;
use Psr\Http\Message\ServerRequestInterface as Request;

class YourController extends BaseController
{
    public function __construct(Container $container, private YourModel $model) {
        parent::__construct($container);
    }

    // Display list of items (GET request)
    public function index(Request $request, Response $response, array $args): Response

    // Show single item details (GET request)
    public function show(Request $request, Response $response, array $args): Response

    // Display a form for creating a new item (GET request)
    public function create(Request $request, Response $response, array $args): Response

    // Handle a request to save a new item to the database (POST request)
    public function store(Request $request, Response $response, array $args): Response

    // Display a form for editing an item (GET request)
    public function edit(Request $request, Response $response, array $args): Response

    // Handle a request to save changes to an item (POST request)
    public function update(Request $request, Response $response, array $args): Response

    // Handle a request to delete an item (GET request)
    public function delete(Request $request, Response $response, array $args): Response
}
```

---

## Standard CRUD Routes URI Patterns

| Action | Method | URI Pattern | Controller Method | Route Name |
|--------|--------|-------------|-------------------|------------|
| List all items | GET | `/products` | `index()` | `products.index` |
| Show one item | GET | `/products/{id}` | `show()` | `products.show` |
| Show create form | GET | `/products/create` | `create()` | `products.create` |
| Handle save new item | POST | `/products` | `store()` | - |
| Show edit form | GET | `/products/{id}/edit` | `edit()` | `products.edit` |
| Save changes  | POST | `/products/{id}` | `update()` | - |
| Delete item | GET | `/products/{id}/delete` | `delete()` | `products.delete` |

---

### Route Registration Example

```php title="app/Routes/web-routes.php"

use App\Controllers\ProductsController;

// 1) List all products
$app->get('/products', [ProductsController::class, 'index'])
    ->setName('products.index');

// 2) Show single product
$app->get('/products/{id}', [ProductsController::class, 'show'])
    ->setName('products.show');

// 3) Show creation form
$app->get('/products/create', [ProductsController::class, 'create'])
    ->setName('products.create');

// 4) Handle save new product
$app->post('/products', [ProductsController::class, 'store']);

// 5) Show edit form
$app->get('/products/{id}/edit', [ProductsController::class, 'edit'])
    ->setName('products.edit');

// 6) Handle update
$app->post('/products/{id}', [ProductsController::class, 'update']);

// 7) Handle delete
$app->get('/products/{id}/delete', [ProductsController::class, 'delete'])
    ->setName('products.delete');
```

:::caution[Route Order Matters]
Place specific routes (like `/create`) **before** parametric routes (like `/{id}`)
:::

---

## Model Class Structure

The `BaseModel` class provides a set of convenient methods for database operations using **prepared statements**. All methods use **named or positional parameters** for security against SQL injection.

Create a model class by extending `BaseModel`. The constructor should call the parent constructor with the `PDOService` instance.


```php title="app/Models/YourModel.php"
<?php
namespace App\Domain\Models;

use App\Helpers\Core\PDOService;

class ProductsModel extends BaseModel
{
    public function __construct(PDOService $db_service) {
        parent::__construct($db_service);
    }
}
```

---

### Retrieve Multiple Records using `selectAll()`

```php
// Get all records
public function getAllProducts(): array
{
    return $this->selectAll('SELECT * FROM products ORDER BY created_at DESC');
}

// With conditions (named parameters)
public function getProductsByCategory(int $categoryId): array
{
    return $this->selectAll('SELECT * FROM products WHERE category_id = :id', ['id' => $categoryId]);
}
```

---

### Retrieve Single Record using `selectOne()`

```php
// Find by ID (positional parameter)
public function findById(int $id): array|false
{
    return $this->selectOne('SELECT * FROM products WHERE id = ?', [$id]);
}

// Find by slug (named parameter)
public function findBySlug(string $slug): array|false
{
    return $this->selectOne('SELECT * FROM products WHERE slug = :slug', ['slug' => $slug]);
}
```

---

### Count Records using `count()`

```php
// Count all
public function getTotalProducts(): int
{
    return $this->count('SELECT COUNT(*) FROM products');
}

// Count with condition
public function countActiveProducts(): int
{
    return $this->count('SELECT COUNT(*) FROM products WHERE status = :status', ['status' => 'active']);
}
```

---

### Insert a new record

```php
// INSERT
public function create(array $data): int
{
    return $this->execute(
        'INSERT INTO products (name, price, created_at) VALUES (:name, :price, :created_at)',
        ['name' => $data['name'], 'price' => $data['price'], 'created_at' => date('Y-m-d H:i:s')]
    );
}
```

---

### Update an existing record

```php
// UPDATE
public function update(int $id, array $data): int
{
    return $this->execute(
        'UPDATE products SET name = :name, price = :price WHERE id = :id',
        ['id' => $id, 'name' => $data['name'], 'price' => $data['price']]
    );
}
```

---

### Delete an existing record

```php
// DELETE
public function delete(int $id): int
{
    return $this->execute('DELETE FROM products WHERE id = :id', ['id' => $id]);
}
```

---

### Get Last Inserted ID using `lastInsertId()`

```php
public function createAndGetId(array $data): string
{
    $this->execute('INSERT INTO products (name, price) VALUES (:name, :price)', $data);
    return $this->lastInsertId();
}
```

---

## BaseController Methods

### Display Views using `render()`

```php
// Basic rendering
return $this->render($response, 'products/index.php');

// Passing data to view
return $this->render($response, 'products/show.php', [
    'product' => $this->model->findById((int) $args['id']),
    'title' => 'Product Details'
]);
```

---

### HTTP Redirects using `redirect()`

**Method Signature:**
```php
protected function redirect(
    Request $request,
    Response $response,
    string $route_name,      // Named route to redirect to
    array $uri_args = [],    // Replaces {placeholders} in route
    array $query_params = [] // Adds ?key=value to URL
): Response
```

:::tip[Key Difference]
- **`$uri_args`** → Replaces route placeholders like `{id}` in `/products/{id}`
- **`$query_params`** → Adds query strings like `?page=2&sort=name`
:::

---

### Examples of Redirects

```php
// Simple redirect (no parameters)
return $this->redirect($request, $response, 'home.index');

// With route parameter (replaces {id}) → /products/123
return $this->redirect($request, $response, 'products.show', ['id' => $productId]);

// With query parameters only → /products?category=electronics&sort=price
return $this->redirect($request, $response, 'products.index', [], [
    'category' => 'electronics',
    'sort' => 'price'
]);

// With BOTH route parameter and query string → /products/123/edit?tab=details
return $this->redirect($request, $response, 'products.edit', ['id' => $productId], [
    'tab' => 'details'
]);
```

---

### Post-Redirect-Get (PRG) Pattern

```php
public function store(Request $request, Response $response, array $args): Response
{
    $productId = $this->model->createAndGetId($request->getParsedBody());
    return $this->redirect($request, $response, 'products.show', ['id' => $productId]);
}
```
---

## Quick Tips

- **Named Parameters** → Use `:name` for better readability in SQL queries
- **Route Names** → Always use `->setName()` for routes you'll redirect to
- **Route Order** → Place `/create` routes **before** `/{id}` routes
- **PRG Pattern** → Always redirect after POST requests to prevent duplicate submissions
- **Validation** → Validate all input data before passing to model methods
- **Error Handling** → Use try-catch blocks and redirect on errors
- **Security** → Use prepared statements (all BaseModel methods do this automatically)

