---
title: CRUD Operations Cheatsheet
description: Quick reference guide for CRUD operations in Slim Framework
sidebar:
  label: 'CRUD Cheatsheet'
  order: 10
  badge:
    text: Reference
    variant: tip
---

## Quick Reference: CRUD Operations in Slim MVC

This cheatsheet provides a quick reference for implementing CRUD operations in your Slim MVC application.

---

## 1. CRUD Controller Methods

### Standard Method Signatures

```php
<?php
use Psr\Http\Message\ResponseInterface as Response;
use Psr\Http\Message\ServerRequestInterface as Request;

class ProductsController extends BaseController
{
    public function __construct(Container $container, private ProductsModel $model) {
        parent::__construct($container);
    }

    // Display list of items (GET)
    public function index(Request $request, Response $response, array $args): Response

    // Show single item details (GET)
    public function show(Request $request, Response $response, array $args): Response

    // Display creation form (GET)
    public function create(Request $request, Response $response, array $args): Response

    // Handle save new item (POST)
    public function store(Request $request, Response $response, array $args): Response

    // Display edit form (GET)
    public function edit(Request $request, Response $response, array $args): Response

    // Handle update item (POST)
    public function update(Request $request, Response $response, array $args): Response

    // Handle delete item (GET)
    public function delete(Request $request, Response $response, array $args): Response
}
```

---

## 2. RESTful Route Patterns

### Standard CRUD Routes

| Action | Method | URI Pattern | Controller Method | Route Name |
|--------|--------|-------------|-------------------|------------|
| List all | GET | `/products` | `index()` | `products.index` |
| Show one | GET | `/products/{id}` | `show()` | `products.show` |
| Create form | GET | `/products/create` | `create()` | `products.create` |
| Store new | POST | `/products` | `store()` | - |
| Edit form | GET | `/products/{id}/edit` | `edit()` | `products.edit` |
| Update | POST | `/products/{id}` | `update()` | - |
| Delete | GET | `/products/{id}/delete` | `delete()` | `products.delete` |

### Route Registration Example

```php
// In app/Routes/web-routes.php

use App\Controllers\ProductsController;

// 1) List all products
$app->get('/products', [ProductsController::class, 'index'])
    ->setName('products.index');

// 2) Show single product
$app->get('/products/{id}', [ProductsController::class, 'show'])
    ->setName('products.show');

// 3) Show creation form
$app->get('/products/create', [ProductsController::class, 'create'])
    ->setName('products.create');

// 4) Handle save new product
$app->post('/products', [ProductsController::class, 'store']);

// 5) Show edit form
$app->get('/products/{id}/edit', [ProductsController::class, 'edit'])
    ->setName('products.edit');

// 6) Handle update
$app->post('/products/{id}', [ProductsController::class, 'update']);

// 7) Handle delete
$app->get('/products/{id}/delete', [ProductsController::class, 'delete'])
    ->setName('products.delete');
```

:::caution[Route Order Matters]
Place specific routes (like `/create`) **before** parametric routes (like `/{id}`)
:::

---

## 3. BaseModel Methods

### Creating a Model

```php
<?php
namespace App\Domain\Models;

use App\Helpers\Core\PDOService;

class ProductsModel extends BaseModel
{
    public function __construct(PDOService $db_service) {
        parent::__construct($db_service);
    }
}
```

---

### selectAll() - Retrieve Multiple Records

```php
// Get all records
public function getAllProducts(): array
{
    return $this->selectAll('SELECT * FROM products ORDER BY created_at DESC');
}

// Get records with conditions (named parameters)
public function getProductsByCategory(int $categoryId): array
{
    return $this->selectAll(
        'SELECT * FROM products WHERE category_id = :category_id',
        ['category_id' => $categoryId]
    );
}
```

---

### selectOne() - Retrieve Single Record

```php
// Find by ID (positional parameter)
public function findById(int $id): array|false
{
    return $this->selectOne('SELECT * FROM products WHERE id = ?', [$id]);
}

// Find by slug (named parameter)
public function findBySlug(string $slug): array|false
{
    return $this->selectOne(
        'SELECT * FROM products WHERE slug = :slug',
        ['slug' => $slug]
    );
}
```

---

### count() - Count Records

```php
// Count all products
public function getTotalProducts(): int
{
    return $this->count('SELECT COUNT(*) FROM products');
}

// Count with condition
public function countActiveProducts(): int
{
    return $this->count(
        'SELECT COUNT(*) FROM products WHERE status = :status',
        ['status' => 'active']
    );
}
```

---

### execute() - Insert, Update, Delete

```php
// INSERT - Create new product
public function create(array $data): int
{
    $rowsAffected = $this->execute(
        'INSERT INTO products (name, price, category_id, created_at)
         VALUES (:name, :price, :category_id, :created_at)',
        [
            'name' => $data['name'],
            'price' => $data['price'],
            'category_id' => $data['category_id'],
            'created_at' => date('Y-m-d H:i:s')
        ]
    );
    return $rowsAffected;
}

// UPDATE - Update existing product
public function update(int $id, array $data): int
{
    return $this->execute(
        'UPDATE products
         SET name = :name, price = :price, updated_at = :updated_at
         WHERE id = :id',
        [
            'id' => $id,
            'name' => $data['name'],
            'price' => $data['price'],
            'updated_at' => date('Y-m-d H:i:s')
        ]
    );
}

// DELETE - Remove product
public function delete(int $id): int
{
    return $this->execute(
        'DELETE FROM products WHERE id = :id',
        ['id' => $id]
    );
}
```

---

### lastInsertId() - Get Last Inserted ID

```php
public function createAndGetId(array $data): string
{
    $this->execute(
        'INSERT INTO products (name, price) VALUES (:name, :price)',
        ['name' => $data['name'], 'price' => $data['price']]
    );

    return $this->lastInsertId();
}
```

---

## 4. BaseController Methods

### render() - Display Views

```php
// Basic rendering
public function index(Request $request, Response $response, array $args): Response
{
    return $this->render($response, 'products/index.php');
}

// Passing data to view
public function show(Request $request, Response $response, array $args): Response
{
    $productId = (int) $args['id'];
    $product = $this->model->findById($productId);

    return $this->render($response, 'products/show.php', [
        'product' => $product,
        'title' => 'Product Details'
    ]);
}
```

---

### redirect() - HTTP Redirects

**Method Signature:**
```php
protected function redirect(
    Request $request,
    Response $response,
    string $route_name,      // Named route to redirect to
    array $uri_args = [],    // Replaces {placeholders} in route
    array $query_params = [] // Adds ?key=value to URL
): Response
```

:::tip[Key Difference]
- **`$uri_args`** → Replaces route placeholders like `{id}` in `/products/{id}`
- **`$query_params`** → Adds query strings like `?page=2&sort=name`
:::

---

### Redirect Examples

```php
// 1) Simple redirect (no parameters)
public function logout(Request $request, Response $response, array $args): Response
{
    session_destroy();
    return $this->redirect($request, $response, 'home.index');
}

// 2) Redirect with route parameter (replaces {id})
public function store(Request $request, Response $response, array $args): Response
{
    $data = $request->getParsedBody();
    $productId = $this->model->createAndGetId($data);

    // Redirects to: /products/123
    return $this->redirect($request, $response, 'products.show', ['id' => $productId]);
}

// 3) Redirect with query parameters only
public function search(Request $request, Response $response, array $args): Response
{
    $term = $request->getQueryParams()['q'] ?? '';

    // Redirects to: /products?category=electronics&sort=price
    return $this->redirect($request, $response, 'products.index', [], [
        'category' => 'electronics',
        'sort' => 'price'
    ]);
}

// 4) Redirect with BOTH route parameter and query string
public function update(Request $request, Response $response, array $args): Response
{
    $productId = (int) $args['id'];
    $this->model->update($productId, $request->getParsedBody());

    // Redirects to: /products/123/edit?tab=details&success=1
    return $this->redirect($request, $response, 'products.edit', ['id' => $productId], [
        'tab' => 'details',
        'success' => '1'
    ]);
}
```

---

### Post-Redirect-Get (PRG) Pattern

```php
public function store(Request $request, Response $response, array $args): Response
{
    $productId = $this->model->createAndGetId($request->getParsedBody());
    return $this->redirect($request, $response, 'products.show', ['id' => $productId]);
}
```

---

## 5. Admin Panel Setup

### Admin Route Group Pattern

```php
// In app/Routes/web-routes.php

$app->group('/admin', function ($group) {
    // Dashboard
    $group->get('/dashboard', [AdminController::class, 'dashboard'])
        ->setName('admin.dashboard');

    // Products management
    $group->get('/products', [ProductsController::class, 'index'])
        ->setName('admin.products.index');
    $group->get('/products/create', [ProductsController::class, 'create'])
        ->setName('admin.products.create');
    $group->post('/products', [ProductsController::class, 'store']);
    $group->get('/products/{id}/edit', [ProductsController::class, 'edit'])
        ->setName('admin.products.edit');
    $group->post('/products/{id}', [ProductsController::class, 'update']);
    $group->get('/products/{id}/delete', [ProductsController::class, 'delete']);

    // Categories management
    $group->get('/categories', [CategoriesController::class, 'index'])
        ->setName('admin.categories.index');
    $group->get('/categories/create', [CategoriesController::class, 'create'])
        ->setName('admin.categories.create');
    $group->post('/categories', [CategoriesController::class, 'store']);

    // Orders management
    $group->get('/orders', [OrdersController::class, 'index'])
        ->setName('admin.orders.index');
    $group->get('/orders/{id}', [OrdersController::class, 'show'])
        ->setName('admin.orders.show');

})->add(AdminAuthMiddleware::class); // Protect ALL routes with middleware
```

:::note[How Route Groups Work]
1. All routes inside the group automatically get `/admin` prefix
2. Middleware applies to **every route** in the group
3. Middleware runs **before** controller methods
:::

---

### Expected Admin File Structure

```
app/
├── Controllers/
│   ├── AdminController.php
│   ├── ProductsController.php
│   ├── CategoriesController.php
│   ├── OrdersController.php
│   └── UsersController.php
├── Models/
│   ├── ProductsModel.php
│   ├── CategoriesModel.php
│   ├── OrdersModel.php
│   └── UsersModel.php
├── Views/
│   └── admin/
│       ├── dashboard.php
│       ├── products/
│       │   ├── index.php
│       │   ├── show.php
│       │   ├── create.php
│       │   └── edit.php
│       ├── categories/
│       │   ├── index.php
│       │   ├── create.php
│       │   └── edit.php
│       └── orders/
│           ├── index.php
│           └── show.php
├── Middleware/
│   └── AdminAuthMiddleware.php
└── Routes/
    └── web-routes.php
```

---

### Admin Middleware Checklist

Your middleware should:
- ✅ Check if user is logged in (authenticated)
- ✅ Check if user has admin privileges
- ✅ Redirect to login page if checks fail
- ✅ Allow access to admin routes if checks pass

---

## 6. Common Patterns & Best Practices

### Extracting Request Data

```php
// Get route parameter (from {id} placeholder)
$productId = (int) $args['id'];

// Get POST form data
$formData = $request->getParsedBody();
$name = $formData['name'] ?? '';

// Get query string parameters (?page=2&sort=name)
$queryParams = $request->getQueryParams();
$page = $queryParams['page'] ?? 1;
$sort = $queryParams['sort'] ?? 'name';
```

---

### Complete CRUD Controller Example

```php
<?php
class ProductsController extends BaseController
{
    public function __construct(Container $container, private ProductsModel $model) {
        parent::__construct($container);
    }

    // List all products
    public function index(Request $request, Response $response, array $args): Response
    {
        $products = $this->model->getAllProducts();
        return $this->render($response, 'products/index.php', ['products' => $products]);
    }

    // Show single product
    public function show(Request $request, Response $response, array $args): Response
    {
        $product = $this->model->findById((int) $args['id']);
        return $this->render($response, 'products/show.php', ['product' => $product]);
    }

    // Display creation form
    public function create(Request $request, Response $response, array $args): Response
    {
        return $this->render($response, 'products/create.php');
    }

    // Handle save new product
    public function store(Request $request, Response $response, array $args): Response
    {
        $data = $request->getParsedBody();
        $productId = $this->model->createAndGetId($data);
        return $this->redirect($request, $response, 'products.show', ['id' => $productId]);
    }

    // Display edit form
    public function edit(Request $request, Response $response, array $args): Response
    {
        $product = $this->model->findById((int) $args['id']);
        return $this->render($response, 'products/edit.php', ['product' => $product]);
    }

    // Handle update product
    public function update(Request $request, Response $response, array $args): Response
    {
        $productId = (int) $args['id'];
        $this->model->update($productId, $request->getParsedBody());
        return $this->redirect($request, $response, 'products.show', ['id' => $productId]);
    }

    // Handle delete product
    public function delete(Request $request, Response $response, array $args): Response
    {
        $this->model->delete((int) $args['id']);
        return $this->redirect($request, $response, 'products.index');
    }
}
```

---

## Quick Tips

- **Named Parameters** → Use `:name` for better readability in SQL queries
- **Route Names** → Always use `->setName()` for routes you'll redirect to
- **Route Order** → Place `/create` routes **before** `/{id}` routes
- **PRG Pattern** → Always redirect after POST requests to prevent duplicate submissions
- **Validation** → Validate all input data before passing to model methods
- **Error Handling** → Use try-catch blocks and redirect on errors
- **Security** → Use prepared statements (all BaseModel methods do this automatically)

---

## Summary Checklist

When implementing CRUD:

1. ✅ Create Model class (extends `BaseModel`)
2. ✅ Create Controller class (extends `BaseController`, inject model)
3. ✅ Implement 7 standard controller methods (index, show, create, store, edit, update, delete)
4. ✅ Create 4 view files (index, show, create, edit)
5. ✅ Register 7 routes in `web-routes.php`
6. ✅ Use named routes for redirects
7. ✅ Follow RESTful URI patterns
8. ✅ Validate input data
9. ✅ Use Post-Redirect-Get pattern
10. ✅ Test all routes in browser
